<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="images/android-desktop.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Material Design Lite">
    <link rel="apple-touch-icon-precomposed" href="images/ios-desktop.png">
    <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#3372DF">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.2.1/material.cyan-light_blue.min.css">
    <link rel="stylesheet" href="styles-dashboard.css">
       <!-- <script src="https://cdn.rawgit.com/showdownjs/showdown/1.5.0/dist/showdown.min.js"></script>-->
<script src="markdown.js"></script>
    <title>Edit Dashboard</title>
    <meta name="description" content="Easily edit all content on the 1509 Online in this easy-to-use dashboard">

    <style>
    #view-source {
      position: fixed;
      display: block;
      right: 0;
      bottom: 0;
      margin-right: 40px;
      margin-bottom: 40px;
      z-index: 900;
    }
	    
	    /* Modal Header */
.modal-header {
    padding: 2px 16px;
    background-color: #00bcd4;
    color: white;
}

/* Modal Body */
.modal-body {padding: 2px 16px;}

/* Modal Footer */
.modal-footer {
    padding: 2px 16px;
    background-color: #00bcd4;
    color: white;
}
	    
	    .cancel {
    float:left;
		    background-color: #efefef;
}
	    
	    .delete {
    float:right;
		    background-color: #efefef;
}

/* Modal Content */
.modal-content {
    position: relative;
    background-color: #fefefe;
    margin: auto;
    padding: 0;
    border: 1px solid #888;
    width: 80%;
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
    -webkit-animation-name: animatetop;
    -webkit-animation-duration: 0.4s;
    animation-name: animatetop;
    animation-duration: 0.4s
}

/* Add Animation */
@-webkit-keyframes animatetop {
    from {top: -300px; opacity: 0} 
    to {top: 0; opacity: 1}
}

@keyframes animatetop {
    from {top: -300px; opacity: 0}
    to {top: 0; opacity: 1}
}
    </style>
  </head>
  <body>
    <div class="demo-layout mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header">
      <header class="demo-header mdl-layout__header mdl-color--grey-100 mdl-color-text--grey-600">
        <div class="mdl-layout__header-row">
          <span class="mdl-layout-title">Articles</span>
          <div class="mdl-layout-spacer"></div>
        </div>      <!-- Tabs -->
    <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
      <a href="#add" class="mdl-layout__tab is-active">Publish</a>
      <a href="#edit" class="mdl-layout__tab">Edit</a>
      <a href="#delete" class="mdl-layout__tab">Delete</a>
    </div>
  </header>
	    <div class="demo-drawer mdl-layout__drawer mdl-color--blue-grey-900 mdl-color-text--blue-grey-50">
        <header class="demo-drawer-header">
          <img src="images/user.jpg" class="demo-avatar">
          <div class="demo-avatar-dropdown">
            <span id="email">example@stpaulsschool.org.uk</span>>
            <div class="mdl-layout-spacer"></div>
          </div>
        </header>
        <nav class="demo-navigation mdl-navigation mdl-color--blue-grey-800">
          <a class="mdl-navigation__link" href="dashboard.html"><i class="mdl-color-text--white material-icons" role="presentation">home</i>Home</a>
          <a class="mdl-navigation__link" href="dash_articles.html"><i class="mdl-color-text--white material-icons" role="presentation">description</i>Articles</a>
          <a class="mdl-navigation__link" href="dash_edit.html"><i class="mdl-color-text--white material-icons" role="presentation">edit</i>Edit Article</a>
          <a class="mdl-navigation__link" href="dash_faq.html"><i class="mdl-color-text--white material-icons" role="presentation">help_outline</i>Help</a>
          <a class="mdl-navigation__link" href="dash_settings.html"><i class="mdl-color-text--white material-icons" role="presentation">settings</i>Settings</a>
		  <a class="mdl-navigation__link" id="sign-out"><i class="mdl-color-text--white material-icons" role="presentation">account_circle</i>Sign Out</a>
          <div class="mdl-layout-spacer"></div>
        </nav>
      </div>
  <main class="mdl-layout__content">
    <section class="mdl-layout__tab-panel is-active" id="add">
      <div class="page-content"><!-- Your content goes here -->
        <div class="mdl-grid demo-content">
			<div class="demo-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--12-col">
				<h2>Publish Article</h2>
				<br>
				<form action="#">
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" id="title">
						<label class="mdl-textfield__label" for="title">Title</label>
					</div>
				</form>
				<hr>
					<!--<form action="#">
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" id="category">
						<label class="mdl-textfield__label" for="category">Category</label>
					</div>
				</form>-->
				<button id="category" class="mdl-button mdl-js-button mdl-js-ripple-effect">
					Select article category   <i class="material-icons">keyboard_arrow_down</i>
				</button>
				<ul id="categories" class="mdl-menu mdl-js-menu mdl-js-ripple-effect" for="category">
					<!--<li id="cat1" onclick="setCat('cat 1');return false;" class="mdl-menu__item">Article Category #1</li>
					<li id="cat2" onclick="setCat('cat 2');return false;" class="mdl-menu__item">Article Category #2</li>
					<li id="cat3" onclick="setCat('cat 3');return false;" class="mdl-menu__item">Article Category #3</li>-->
				</ul>
				
				<hr>				<form action="#">
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" id="user" pattern="[A-Z,a-z, ]*">
						<label class="mdl-textfield__label" for="user">Author Name</label>
					</div>
				</form>
				<hr>
				<form action="#">
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" pattern="[0-9,/]*" id="date">
						<label class="mdl-textfield__label" for="date">Date</label>
						<span class="mdl-textfield__error">That is not a valid date!</span>
					</div>
				</form>
				<hr>
				<form action="#">
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" id="image">
						<label class="mdl-textfield__label" for="image">Image URL (at least 820 pixels in width)</label>
					</div>
				</form>
				<hr>
				<form action="#">
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" id="summary">
						<label class="mdl-textfield__label" for="summary">Summary AND/OR Description</label>
					</div>
				</form>
				<hr>
				<form action="#">
					<div class="mdl-textfield mdl-js-textfield">
						<textarea class="mdl-textfield__input" type="text" style="width:100%;" id="code" onchange="preview()"></textarea>
						<label class="mdl-textfield__label" for="code">Article Text</label>
					</div>
				</form>
				<hr>
				<p id="preview"></p>
				<a id="publish" class="mdl-button mdl-js-button mdl-js-ripple-effect"><i class="material-icons">check</i>   Done, publish article</a>
			</div>
		</div>
    </div>
    </section>
    <section class="mdl-layout__tab-panel" id="edit">
      <div class="page-content"><!-- Your content goes here -->
        <div class="mdl-grid demo-content">
			<div class="demo-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--12-col">
				<h2>Edit Article</h2>
				<br>
					<!--<form action="#">
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" id="category">
						<label class="mdl-textfield__label" for="category">Category</label>
					</div>
				</form>-->
				<button id="category-edit" class="mdl-button mdl-js-button mdl-js-ripple-effect">
					Select article category   <i class="material-icons">keyboard_arrow_down</i>
				</button>
				<ul id="categories-edit" class="mdl-menu mdl-js-menu mdl-js-ripple-effect" for="category-edit">
					<!--<li id="cat1" onclick="setCat('cat 1');return false;" class="mdl-menu__item">Article Category #1</li>
					<li id="cat2" onclick="setCat('cat 2');return false;" class="mdl-menu__item">Article Category #2</li>
					<li id="cat3" onclick="setCat('cat 3');return false;" class="mdl-menu__item">Article Category #3</li>-->
				</ul>
				
				<hr><button id="title-edit" class="mdl-button mdl-js-button mdl-js-ripple-effect">
					Select article title   <i class="material-icons">keyboard_arrow_down</i>
				</button>
				<ul id="titles-edit" class="mdl-menu mdl-js-menu mdl-js-ripple-effect" for="title-edit">
					<!--<li id="cat1" onclick="setCat('cat 1');return false;" class="mdl-menu__item">Article Category #1</li>
					<li id="cat2" onclick="setCat('cat 2');return false;" class="mdl-menu__item">Article Category #2</li>
					<li id="cat3" onclick="setCat('cat 3');return false;" class="mdl-menu__item">Article Category #3</li>-->
				</ul>
				
				<hr>				<form action="#">
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" id="user-edit" pattern="[A-Z,a-z, ]*">
						<label class="mdl-textfield__label" for="user-edit">Author Name</label>
					</div>
				</form>
				<hr>
				<form action="#">
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" pattern="[0-9,/]*" id="date-edit">
						<label class="mdl-textfield__label" for="date-edit">Date</label>
						<span class="mdl-textfield__error">That is not a valid date!</span>
					</div>
				</form>
				<hr>
				<form action="#">
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" id="image-edit">
						<label class="mdl-textfield__label" for="image-edit">Image URL (at least 820 pixels in width)</label>
					</div>
				</form>
				<hr>
				<form action="#">
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" id="summary-edit">
						<label class="mdl-textfield__label" for="summary-edit">Summary AND/OR Description</label>
					</div>
				</form>
				<hr>
				<form action="#">
					<div class="mdl-textfield mdl-js-textfield">
						<textarea class="mdl-textfield__input" type="text" rows="10" id="code-edit" onchange="preview()"></textarea>
						<label class="mdl-textfield__label" for="code-edit">Article Text</label>
					</div>
				</form>
				<hr>
				<p id="preview-edit"></p>
				<a id="publish-edit" class="mdl-button mdl-js-button mdl-js-ripple-effect"><i class="material-icons">check</i>   Done, publish article</a>
			</div>
		</div>
    </div>
    </section>
    <section class="mdl-layout__tab-panel" id="delete">
      <div class="page-content"><!-- Your content goes here -->
	      <!-- The Modal -->
<div id="modal" class="modal">
	      <!-- Modal content -->
<div class="modal-content">
  <div class="modal-header">
    
    <h2>Delete?</h2>
  </div>
  <div class="modal-body">
    <p>Are you sure you want to delete this article?</p>
    <p>Deleting the article will remove it remove it forever.</p>
  </div>
  <div class="modal-footer">
	  <button id="close-dialog" class="mdl-button mdl-js-button mdl-button--raised cancel">
  Cancel
</button>
	  <button id="delete-dialog" class="mdl-button mdl-js-button mdl-button--raised delete">
  Delete
</button>
  </div>
</div>
	      </div>
	    <h2>Delete Article</h2>
				<br>
					<!--<form action="#">
					<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
						<input class="mdl-textfield__input" type="text" id="category">
						<label class="mdl-textfield__label" for="category">Category</label>
					</div>
				</form>-->
				<button id="category-delete" class="mdl-button mdl-js-button mdl-js-ripple-effect">
					Select article category   <i class="material-icons">keyboard_arrow_down</i>
				</button>
				<ul id="categories-delete" class="mdl-menu mdl-js-menu mdl-js-ripple-effect" for="category-delete">
					<!--<li id="cat1" onclick="setCat('cat 1');return false;" class="mdl-menu__item">Article Category #1</li>
					<li id="cat2" onclick="setCat('cat 2');return false;" class="mdl-menu__item">Article Category #2</li>
					<li id="cat3" onclick="setCat('cat 3');return false;" class="mdl-menu__item">Article Category #3</li>-->
				</ul>
				
				<hr><button id="title-delete" class="mdl-button mdl-js-button mdl-js-ripple-effect">
					Select article title   <i class="material-icons">keyboard_arrow_down</i>
				</button>
				<ul id="titles-delete" class="mdl-menu mdl-js-menu mdl-js-ripple-effect" for="title-delete">
					<!--<li id="cat1" onclick="setCat('cat 1');return false;" class="mdl-menu__item">Article Category #1</li>
					<li id="cat2" onclick="setCat('cat 2');return false;" class="mdl-menu__item">Article Category #2</li>
					<li id="cat3" onclick="setCat('cat 3');return false;" class="mdl-menu__item">Article Category #3</li>-->
				</ul>
	      <hr>
	      <a id="delete-button" class="mdl-button mdl-js-button mdl-js-ripple-effect"><i class="material-icons">delete_forever</i> Delete</a>
	     
	    </div>
    </section>
    
  </main>
      
      
    </div>
<script src="https://www.gstatic.com/firebasejs/3.5.2/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.5.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.5.2/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.5.2/firebase-auth.js"></script>
    <script>
        //Markdown
        var converter = new showdown.Converter();
        
	    //Test thing
	    /*document.getElementById("cat1").removeAttribute("disabled");
	    document.getElementById("cat1").setAttribute("disabled", "true");*/
		//Preview article content method
		function preview() {
			var text = converter.makeHtml(document.getElementById("code").value);
			document.getElementById("preview").innerHTML = text;
		}
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyChG9cMyAkkZSXCZp1OmfpxbJYnJvh3XnQ",
        authDomain: "online-eff31.firebaseapp.com",
        databaseURL: "https://online-eff31.firebaseio.com",
        storageBucket: "online-eff31.appspot.com",
        messagingSenderId: "655714895872"
      };
      firebase.initializeApp(config);
        /*var provider = new firebase.auth.GoogleAuthProvider();*/
        firebase.auth().onAuthStateChanged(function(user) {
		if (user) {
			// User is signed in
			document.getElementById("email").innerHTML = user.email;
		} else {
			// User is not signed in, revert to homepage.
			window.location = "https://1509-online.github.io/index.html"
		}
		});
		
		//Sign Out Button
        document.getElementById("sign-out").addEventListener("click", function(){
        firebase.auth().signOut().then(function() {
				// Sign-out successful.
			}, function(error) {
				// An error happened.
			});
        });
	    function setCat(name) {
		   document.getElementById("category").innerHTML = name + `   <i class="material-icons">keyboard_arrow_down</i>`;
	    }
	   
	var database = firebase.database();
      var homepageRef = database.ref('entries');
homepageRef.on('value', function(snapshot) {
	document.getElementById("categories").innerHTML = "";
	snapshot.forEach(function(childSnapshot) {
    var childKey = childSnapshot.getKey();
    var childData = childSnapshot.val();
		var list = document.getElementById("categories");
  list.innerHTML += `<li onclick="setCat('` + childSnapshot.getKey() + `');return false;" class="mdl-menu__item">` + childSnapshot.getKey().replace(/&20/g," ") + `</li>`
		
		
    // ...
  });
});
		
		//Publish Method
        document.getElementById("publish").addEventListener("click", function(){
            var title = document.getElementById("title").value;
	    var article = converter.makeHtml(document.getElementById("code").value);
            var user = document.getElementById("user").value;
            var date = document.getElementById("date").value;
            var description = document.getElementById("summary").value;
            var image = document.getElementById("image").value;
		var cat = document.getElementById("category").innerHTML.replace(`   <i class="material-icons">keyboard_arrow_down</i>`,'');
            //To prevent accidents. I had one and it deleted everything :(
            if (title != "") {
            var articleRef = firebase.database().ref('entries/' + cat + "/" + title);
            // An article entry.
            articleRef.set({ body: article, user: user, date: date, summary: description, image: image })
            .then(function() {
                  console.log('Synchronization succeeded');
                  alert("Success");
                  var title = document.getElementById("title").value = "";
                  var article = document.getElementById("code").value = "";
                  var user = document.getElementById("user").value = "";
                  var date = document.getElementById("date").value = "";
                  var description = document.getElementById("summary").value = "";
                  var image = document.getElementById("image").value = "";
                document.getElementById("preview").innerHTML = "";
                  })
                  .catch(function(error) {
                         console.log('Synchronization failed');
                         alert(error);
                    });
            } else {
                alert("Add a title");
            }
		});
		
		//Style text function for non-code editors and publishers
		function style(text) {
			//Newline \n
			returnText = text.replace(/\n/g,"<br>");
			//Header <h2> # ##
			returnText = returnText.replace(/##/g,"</h2>");
			returnText = returnText.replace(/#/g,"<h2>");
			//Italics <i> *** ****
			returnText = returnText.replace(/\*\*\*\*/g,"</i>");
			returnText = returnText.replace(/\*\*\*/g,"<i>");
			//Bold <b> * **
			returnText = returnText.replace(/\*\*/g,"</b>");
			returnText = returnText.replace(/\*/g,"<b>");
			//Underline <u> _ __
			returnText = returnText.replace(/__/g,"</u>");
			returnText = returnText.replace(/_/g,"<u>");
			return returnText;
		}
function setCatEdit(name) {
		   document.getElementById("category-edit").innerHTML = name.replace(/%20/g," ") + `   <i class="material-icons">keyboard_arrow_down</i>`;
		    var database = firebase.database();
      var homepageRef = database.ref('entries/' + name);
homepageRef.on('value', function(snapshot) {
	document.getElementById("titles-edit").innerHTML = "";
	snapshot.forEach(function(childSnapshot) {
    var childKey = childSnapshot.getKey();
    var childData = childSnapshot.val();
		var list = document.getElementById("titles-edit");
		if (childSnapshot.getKey() != "summary") {
  list.innerHTML += `<li class="mdl-menu__item" onclick="setTitleEdit('` + childSnapshot.getKey().replace(/%20/g," ") + `');return false;" >` + childSnapshot.getKey() + `</li>`
		}
		
    // ...
  });
});
	    }
	   
	 function setTitleEdit(name) {
		   document.getElementById("title-edit").innerHTML = name + `   <i class="material-icons">keyboard_arrow_down</i>`;
		    
	    }   
	    
	var database = firebase.database();
      var homepageRef = database.ref('entries');
homepageRef.on('value', function(snapshot) {
	document.getElementById("categories-edit").innerHTML = "";
	snapshot.forEach(function(childSnapshot) {
    var childKey = childSnapshot.getKey();
    var childData = childSnapshot.val();
		var list = document.getElementById("categories-edit");
  list.innerHTML += `<li onclick="setCatEdit('` + childSnapshot.getKey() + `');return false;" class="mdl-menu__item">` + childSnapshot.getKey() + `</li>`
		
		
    // ...
  });
});
		
		//Publish Method
        document.getElementById("publish-edit").addEventListener("click", function(){
            var title = document.getElementById("title-edit").innerHTML.replace(`   <i class="material-icons">keyboard_arrow_down</i>`,'');
	    var article = converter.makeHtml(document.getElementById("code-edit").value);
            var user = document.getElementById("user-edit").value;
            var date = document.getElementById("date-edit").value;
            var description = document.getElementById("summary-edit").value;
            var image = document.getElementById("image-edit").value;
		var cat = document.getElementById("category-edit").innerHTML.replace(`   <i class="material-icons">keyboard_arrow_down</i>`,'');
            //To prevent accidents. I had one and it deleted everything :(
            if (title != "") {
            var articleRef = firebase.database().ref('entries/' + cat + "/" + title);
            // An article entry.
            articleRef.set({ body: article, user: user, date: date, summary: description, image: image })
            .then(function() {
                  console.log('Synchronization succeeded');
                  alert("Success");
                  var title = document.getElementById("title-edit").value = "";
                  var article = document.getElementById("code-edit").value = "";
                  var user = document.getElementById("user-edit").value = "";
                  var date = document.getElementById("date-edit").value = "";
                  var description = document.getElementById("summary-edit").value = "";
                  var image = document.getElementById("image-edit").value = "";
                document.getElementById("preview-edit").innerHTML = "";
                  })
                  .catch(function(error) {
                         console.log('Synchronization failed');
                         alert(error);
                    });
            } else {
                alert("Add a title");
            }
		});
	    document.getElementById("modal").style.display = "none";
	    
	    document.getElementById("close-dialog").addEventListener("click", function(){
		    modal.style.display = "none";
			alert('cancelled');
	    });
	    
	    document.getElementById("delete-dialog").addEventListener("click", function(){
		    modal.style.display = "none";
			alert('deleting\nNot done yet so it\'s not actually deleting');
	    });
	    
	    document.getElementById("delete-button").addEventListener("click", function(){
		    modal.style.display = "block";
	    });
	    
		function setCatEdit(name) {
		   document.getElementById("category-delete").innerHTML = name.replace(/%20/g," ") + `   <i class="material-icons">keyboard_arrow_down</i>`;
		    var database = firebase.database();
      var homepageRef = database.ref('entries/' + name);
homepageRef.on('value', function(snapshot) {
	document.getElementById("titles-delete").innerHTML = "";
	snapshot.forEach(function(childSnapshot) {
    var childKey = childSnapshot.getKey();
    var childData = childSnapshot.val();
		var list = document.getElementById("titles-delete");
		if (childSnapshot.getKey() != "summary") {
  list.innerHTML += `<li class="mdl-menu__item" onclick="setTitleDelete('` + childSnapshot.getKey().replace(/%20/g," ") + `');return false;" >` + childSnapshot.getKey() + `</li>`
		}
		
    // ...
  });
});
	    }
	   
	 function setTitleDelete(name) {
		   document.getElementById("title-delete").innerHTML = name + `   <i class="material-icons">keyboard_arrow_down</i>`;
		    
	    }   
	    
	var database = firebase.database();
      var homepageRef = database.ref('entries');
homepageRef.on('value', function(snapshot) {
	document.getElementById("categories-delete").innerHTML = "";
	snapshot.forEach(function(childSnapshot) {
    var childKey = childSnapshot.getKey();
    var childData = childSnapshot.val();
		var list = document.getElementById("categories-delete");
  list.innerHTML += `<li onclick="setCatDelete('` + childSnapshot.getKey() + `');return false;" class="mdl-menu__item">` + childSnapshot.getKey() + `</li>`
		
		
    // ...
  });
});
			
		
	</script>
    <script src="https://code.getmdl.io/1.2.1/material.min.js"></script>
	
  </body>
</html>
